{% extends 'base.html' %}

{% block content %}
  <h1>Settings</h1>
  <form method="post">
    <div class="form-row">
      <label for="host">Host/IP</label>
      <input id="host" name="host" type="text" value="{{ config.host }}" />
    </div>
    <div class="form-row">
      <label for="port">Port</label>
      <input id="port" name="port" type="number" value="{{ config.port }}" />
    </div>
    <div class="form-row">
      <label for="display">Display Mode</label>
      <select id="display" name="display">
        <option value="gauges" {% if config.display=='gauges' %}selected{% endif %}>Gauges</option>
        <option value="bars" {% if config.display=='bars' %}selected{% endif %}>Progress Bars</option>
        <option value="raw" {% if config.display=='raw' %}selected{% endif %}>Raw Numbers</option>
      </select>
    </div>
    <div class="form-row">
      <label>Time Format</label>
      <label><input type="radio" name="time_format" value="24" {% if config.time_format!='12' %}checked{% endif %}/> 24-hour</label>
      <label style="margin-left:12px"><input type="radio" name="time_format" value="12" {% if config.time_format=='12' %}checked{% endif %}/> 12-hour</label>
    </div>
    <div class="form-row">
      <label for="theme">Theme</label>
      <select id="theme" name="theme">
        <option value="light" {% if config.theme=='light' %}selected{% endif %}>Light</option>
        <option value="dark" {% if config.theme=='dark' %}selected{% endif %}>Dark</option>
        <option value="plex" {% if config.theme=='plex' %}selected{% endif %}>Plex</option>
        <option value="jellyfin" {% if config.theme=='jellyfin' %}selected{% endif %}>Jellyfin</option>
        <option value="highcontrast" {% if config.theme=='highcontrast' %}selected{% endif %}>High Contrast</option>
      </select>
    </div>
    <div class="form-row">
      <label><input type="checkbox" name="show_update_time" {% if config.show_update_time %}checked{% endif %}/> Show global update time (top-right)</label>
    </div>
    <div class="form-row">
      <h3>Network</h3>
      <label for="net-interface">Interface</label>
      <select id="net-interface" name="net-interface">
        <option value="">All</option>
      </select>
      <label for="net-baseline" style="display:block;margin-top:8px;">Baseline</label>
      <select id="net-baseline" name="net-baseline">
        <option value="100">100 Mbps</option>
        <option value="1000">1 Gbps</option>
        <option value="10000">10 Gbps</option>
      </select>
      <div style="margin-top:8px;color:var(--muted);font-size:0.9em;">Pick which interface to monitor and a baseline for normalization.</div>
    </div>
    <div class="form-row">
      <button type="submit">Save</button>
    </div>
  </form>
  <script>
    // populate interface list from API and wire change to POST selection
    async function populateNetSettings(){
      try{
        const res = await fetch('/api/stats');
        if(!res.ok) return;
        const data = await res.json();
        const sel = document.getElementById('net-interface');
        if(sel && data.network && Array.isArray(data.network.interfaces)){
          const cur = sel.value;
          sel.innerHTML = '<option value="">All</option>' + data.network.interfaces.map(i=>`<option value="${i}">${i}</option>`).join('');
          if(data.network.selected_interface) sel.value = data.network.selected_interface || '';
        }
        const baseline = document.getElementById('net-baseline');
        if(baseline && data.network && data.network.baseline_mbps) baseline.value = data.network.baseline_mbps;
      }catch(e){ console.warn('net settings populate', e); }
    }
    populateNetSettings();
    document.getElementById('net-interface').addEventListener('change', async function(){
      try{ await fetch('/api/net_interface', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({iface: this.value || null, baseline_mbps: Number(document.getElementById('net-baseline').value)})}); }catch(e){console.warn(e)}
    });
    document.getElementById('net-baseline').addEventListener('change', async function(){
      try{ await fetch('/api/net_interface', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({iface: document.getElementById('net-interface').value || null, baseline_mbps: Number(this.value)})}); }catch(e){console.warn(e)}
    });
  </script>
{% endblock %}
